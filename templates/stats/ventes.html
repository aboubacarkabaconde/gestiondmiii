{% extends "base.html" %}
{% block title %}Statistiques Ventes - Gestion D.M.I{% endblock %}

{% block content %}
<div class="container-fluid">
  <h4 class="section-title">Statistiques â€” Ventes</h4>
  <form method="get" class="row g-2 mb-3">
    <div class="col-6 col-md-3"><input name="start" value="{{ filtre.start|date:'Y-m-d' }}" type="date" class="form-control"></div>
    <div class="col-6 col-md-3"><input name="end"   value="{{ filtre.end|date:'Y-m-d' }}"   type="date" class="form-control"></div>
    <div class="col-6 col-md-3"><input name="site_id" value="{{ filtre.site_id }}" class="form-control" placeholder="Site ID"></div>
    <div class="col-12 col-md-2"><button class="btn btn-primary w-100">Filtrer</button></div>
  </form>

  {{ labels|json_script:"ven-labels" }}
  {{ serie_ventes|json_script:"ven-serie" }}

  <div class="card dashboard-card">
    <div class="card-body">
      <div style="position:relative;height:360px"><canvas id="chartVentes"></canvas></div>
      <p class="mt-3 mb-0">Total : <span class="fw-bold text-success">{{ total_ventes }}</span></p>
    </div>
  </div>
</div>
{% endblock %}

{% block extra_js %}
<script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>
<script>
const vLabels = JSON.parse(document.getElementById("ven-labels").textContent || "[]");
const vData   = JSON.parse(document.getElementById("ven-serie").textContent || "[]");
new Chart(document.getElementById('chartVentes'), {
  type:'line',
  data:{labels:vLabels, datasets:[{label:'Ventes (CA)', data:vData, tension:.35, fill:true,
    borderColor:'rgba(25,135,84,1)', backgroundColor:'rgba(25,135,84,.25)'}]},
  options:{responsive:true, maintainAspectRatio:false, scales:{y:{beginAtZero:true}}}
});
</script>
{% endblock %}
