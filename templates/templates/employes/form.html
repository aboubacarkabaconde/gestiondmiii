{% extends 'base.html' %}{% load crispy_forms_tags %}
{% block title %}Employé - Gestion D.M.I{% endblock %}
{% block content %}
<div class="container-fluid">
  <div class="d-flex justify-content-between align-items-center mb-4">
    <h1 class="section-title mb-0"><i class="bi bi-person-gear me-2"></i>{% if employe and employe.pk %}Modifier{% else %}Ajouter{% endif %} un Employé</h1>
    <a href="{% url 'employes:liste' %}" class="btn btn-outline-secondary"><i class="bi bi-arrow-left"></i> Retour</a>
  </div>
  <div class="card dashboard-card">
    <div class="card-header"><h4 class="card-title mb-0">{% if employe and employe.pk %}Édition{% else %}Création{% endif %}</h4></div>
    <div class="card-body">
      <form method="post" class="vstack gap-3">{% csrf_token %}
        <div class="row g-4">
          <div class="col-12 col-md-6"><h5 class="mb-3">Informations de connexion</h5>{{ user_form|crispy }}</div>
          <div class="col-12 col-md-6"><h5 class="mb-3">Informations professionnelles</h5>{{ employe_form|crispy }}</div>
        </div>
        <div class="d-flex justify-content-between mt-4">
          <a href="{% url 'employes:liste' %}" class="btn btn-secondary">Annuler</a>
          <button type="submit" class="btn btn-primary">Enregistrer</button>
        </div>
      </form>
    </div>
  </div>
</div>
{% endblock %}
{% block extra_js %}
<script>
document.addEventListener('DOMContentLoaded',function(){
  const firstNameField=document.getElementById('id_first_name');
  const lastNameField=document.getElementById('id_last_name');
  const usernameField=document.getElementById('id_username');
  function slugify(str){return (str||'').normalize('NFD').replace(/[̀-ͯ]/g,'').replace(/[^a-z0-9]/gi,'').toLowerCase()}
  function generate() {
    if(!firstNameField||!lastNameField||!usernameField) return;
    if(usernameField.value && usernameField.value.trim()) return;
    const fn=slugify(firstNameField.value), ln=slugify(lastNameField.value);
    if(fn && ln) usernameField.value = fn.charAt(0)+ln;
  }
  firstNameField && firstNameField.addEventListener('blur',generate);
  lastNameField && lastNameField.addEventListener('blur',generate);
});
</script>
{% endblock %}
